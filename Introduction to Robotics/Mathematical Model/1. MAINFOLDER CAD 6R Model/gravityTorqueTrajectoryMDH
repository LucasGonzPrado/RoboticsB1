function Tau_g = gravityTorqueTrajectoryMDH(MDH, Q, m_payload, g)
% GRAVITYTORQUETRAJECTORYMDH  Payload gravity torques along a trajectory.
%
%   Tau_g = gravityTorqueTrajectoryMDH(MDH, Q, m_payload, g)
%
%   Inputs:
%     MDH        : n x 5 MDH table
%     Q          : n x N matrix of joint positions over time
%     m_payload  : payload mass at wrist center [kg]
%     g          : scalar gravity (default 9.81 m/s^2)
%
%   Output:
%     Tau_g      : N x n matrix, row k = torque at time t_k [NÂ·m]
%
%   Notes:
%     - Same approximation as staticTorquePayloadMDH: payload at frame {n}
%       origin, link weights ignored (good for homework-level analysis).

    if nargin < 4 || isempty(g)
        g = 9.81;
    end

    [n, N] = size(Q);

    Tau_g = zeros(N, n);
    Fg    = [0; 0; -m_payload*g; 0; 0; 0];  % constant wrench

    for k = 1:N
        qk = Q(:,k);
        Jk = jacobianMDH(MDH, qk);      % 6 x n
        Tau_g(k,:) = (Jk.' * Fg).';     % 1 x n
    end
end
